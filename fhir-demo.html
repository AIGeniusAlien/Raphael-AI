
<!doctype html>
<html>
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Raphael — FHIR Demo</title>
  <style>body{font-family:system-ui,Arial;margin:20px} #log{white-space:pre-wrap;border:1px solid #ddd;padding:12px;border-radius:8px;min-height:140px}</style>
</head>
<body>
  <h2>Raphael — FHIR Demo (sandbox drafts)</h2>
  <div>
    <a href="/" style="margin-right:10px">Standard</a>
    <a href="/handsfree">Hands-free</a>
  </div>
  <p><button id="auth">Authorize FHIR</button></p>
  <p><label>Patient ID: <input id="pid" size="20" placeholder="123"></label></p>
  <p><textarea id="note" rows="6" cols="60" placeholder="Clinical note content..."></textarea></p>
  <p><button id="analyze">Analyze</button> <button id="confirm">Confirm → FHIR (draft)</button></p>
  <pre id="log"></pre>
<script>
const log = (m)=>document.getElementById('log').textContent += "\n"+m;
document.getElementById('auth').onclick = ()=> window.location = "/fhir/authorize";
document.getElementById('analyze').onclick = ()=> log("> analyzed draft (mock) with citations + safety gates");
document.getElementById('confirm').onclick = async ()=>{
  const pid = document.getElementById('pid').value.trim() || "TEST-001";
  const note = document.getElementById('note').value.trim() || "Auto-generated note draft";
  let r = await fetch("/fhir/draft/note?patient_id="+encodeURIComponent(pid)+"&content="+encodeURIComponent(note),{method:"POST"});
  log(await r.text());
  r = await fetch("/fhir/draft/orders?patient_id="+encodeURIComponent(pid),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(["CBC","BMP"])});
  log(await r.text());
};
</script>
</body>
</html>
